<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Urgent Offer</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    background:#0b0b0b;
    color:#fff;
    font-family:Arial,sans-serif;
}
.video-container{
    max-width:900px;
    margin:40px auto;
}
.video-wrapper{
    position:relative;
    width:100%;
    padding-bottom:56.25%;
    background:#000;
}
#videoPlayerContainer,
#adContainer{
    position:absolute;
    inset:0;
}
#contentVideo{
    width:100%;
    height:100%;
    object-fit:contain;
    background:#000;
    pointer-events:none;
}
.video-overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.8);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
.video-overlay.hidden{
    display:none;
}
.play-icon{
    width:80px;
    height:80px;
    border-radius:50%;
    background:linear-gradient(135deg,#8B5CF6,#3B82F6);
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
}
.play-icon svg{
    width:32px;
    height:32px;
    fill:#fff;
    margin-left:4px;
}
.ad-loading{
    margin-top:20px;
    color:#8B5CF6;
    display:none;
}
.ad-loading.active{
    display:block;
}
@media(max-width:768px){
    .video-container{margin:0}
    .play-icon{width:60px;height:60px}
}
</style>
</head>

<body>

<div class="video-container">
    <div class="video-wrapper">

        <div class="video-overlay" id="videoOverlay">
            <div class="play-icon" id="playButton">
                <svg viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                </svg>
            </div>
            <div class="ad-loading" id="adLoading">Загрузка рекламы…</div>
        </div>

        <div id="videoPlayerContainer"></div>
    </div>
</div>

<script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

const videoUrl = 'video.mp4';
const vastUrl  = 'https://vast.vstserv.com/vast?spot_id=2015008&skipoffset=10';

let player;
let adDisplayContainer;
let adsLoader;
let adsManager;
let canPlayContent = false;

/* ---------- VIDEO ---------- */
function initPlayer(){
    player = document.createElement('video');
    player.id = 'contentVideo';
    player.controls = false;
    player.muted = true;
    player.playsInline = true;
    player.setAttribute('webkit-playsinline','true');
    player.preload = 'auto';

    const source = document.createElement('source');
    source.src = videoUrl;
    source.type = 'video/mp4';

    player.appendChild(source);
    document.getElementById('videoPlayerContainer').appendChild(player);

    initAds();
}

/* ---------- ADS ---------- */
function initAds(){
    const adContainer = document.createElement('div');
    adContainer.id = 'adContainer';
    document.getElementById('videoPlayerContainer').appendChild(adContainer);

    adDisplayContainer = new google.ima.AdDisplayContainer(adContainer, player);
    adsLoader = new google.ima.AdsLoader(adDisplayContainer);

    adsLoader.addEventListener(
        google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
        onAdsLoaded
    );
    adsLoader.addEventListener(
        google.ima.AdErrorEvent.Type.AD_ERROR,
        onAdError
    );
}

function requestAds(){
    const adsRequest = new google.ima.AdsRequest();
    adsRequest.adTagUrl = vastUrl;

    const w = document.querySelector('.video-wrapper').offsetWidth;
    const h = document.querySelector('.video-wrapper').offsetHeight;

    adsRequest.linearAdSlotWidth = w;
    adsRequest.linearAdSlotHeight = h;

    adsLoader.requestAds(adsRequest);
}

function onAdsLoaded(e){
    adsManager = e.getAdsManager(player);
    adsManager.addEventListener(
        google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,
        onAdsFinished
    );
    adsManager.addEventListener(
        google.ima.AdErrorEvent.Type.AD_ERROR,
        onAdError
    );
const w = document.querySelector('.video-wrapper').offsetWidth;
    const h = document.querySelector('.video-wrapper').offsetHeight;

    adsManager.init(w, h, google.ima.ViewMode.NORMAL);
    adsManager.start();
}

function onAdsFinished(){
    canPlayContent = true;
    player.muted = false;
    player.controls = true;
    player.style.pointerEvents = 'auto';
    player.play();
}

function onAdError(){
    onAdsFinished();
}

/* ---------- START ---------- */
document.getElementById('playButton').addEventListener('click', () => {

    document.getElementById('videoOverlay').classList.add('hidden');
    document.getElementById('adLoading').classList.add('active');

    if(!player) initPlayer();

    // ❗ строго в пользовательском клике
    adDisplayContainer.initialize();
    requestAds();
});

});
</script>

</body>
</html>
